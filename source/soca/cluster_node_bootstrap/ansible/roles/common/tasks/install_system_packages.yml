# ========
# Install System packages for SOCA master/compute node
# Maintainer: mcrozes@
# ========

- hosts: localhost
  tasks:
    - name: Load all variables
      include_vars:
        file: ../vars/system_variables.yml
        name: system

    - name: Install SYSTEM_PKGS required packages for RHEL distros
      yum:
        name: "{{ system.SYSTEM_PKGS }}"
        state: present
        enablerepo: "rhui-REGION-rhel-server-optional"
      when: ansible_distribution == "Red Hat Enterprise Linux"

    - name: Install SYSTEM_PKGS required packages for non-RHEL distros
      yum:
        name: "{{ system.SYSTEM_PKGS }}"
        state: present
      when: ansible_distribution != "Red Hat Enterprise Linux"

    - name: Install SCHEDULER_PKGS required packages for RHEL distro only
      yum:
        name: "{{ system.SCHEDULER_PKGS }}"
        state: present
        enablerepo: "rhui-REGION-rhel-server-optional"
      when: ansible_distribution == "Red Hat Enterprise Linux"

    - name: Install SCHEDULER_PKGS required packages for non-RHEL distro
      yum:
        name: "{{ system.SCHEDULER_PKGS }}"
        state: present
      when: ansible_distribution != "Red Hat Enterprise Linux"

    - name: Install OPENLDAP_SERVER_PKGS required packages
      yum:
        name: "{{ system.OPENLDAP_SERVER_PKGS }}"
        state: present

    - name: Install SSSD_PKGS required packages
      yum:
        name: "{{ system.SSSD_PKGS }}"
        state: present

    - name: List installed packages
      debug:
        msg:
          - "Installed SYSTEM_PKGS: {{ system.SYSTEM_PKGS }}"
          - "Installed SCHEDULER_PKGS: {{ system.SCHEDULER_PKGS }}"
          - "Installed SSSD_PKGS: {{ system.SSSD_PKGS }}"
          - "Installed OPENLDAP_SERVER_PKGS: {{ system.OPENLDAP_SERVER_PKGS }}"



