# ========
# Configure EFS mounts for SOCA
# Maintainer: mcrozes@
# ========

- hosts: localhost
  vars:
    SOCA_EFS_DATA: "{{ lookup('env','SOCA_EFS_DATA') }}"
    SOCA_EFS_APP: "{{ lookup('env','SOCA_EFS_APP') }}"

  tasks:
    - name: Create /apps mountpoint
      file:
        path: /apps
        state: directory
        mode: 0755

    - name: Create /data mountpoint
      file:
        path: /data
        state: directory
        mode: 0755

    - name: Mount EFS /apps
      mount:
        name: /apps
        src: "{{ SOCA_EFS_APP }}:/"
        fstype: nfs
        opts: "nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2"
        state: mounted

    - name: Mount EFS /data
      mount:
        name: /data
        src: "{{ SOCA_EFS_DATA }}:/"
        fstype: nfs
        opts: "nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2"
        state: mounted