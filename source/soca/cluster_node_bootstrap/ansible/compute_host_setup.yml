# Playbook is called by ComputeNode.sh
# Make sure to set -a to force auto export before running ansible-playbook
# set -a
# source /etc/environment
# source config.cfg
# set +a

# Variables you can use in your playbook for customization
#
# SOCA_CONFIGURATION
# SOCA_BASE_OS
# SOCA_JOB_QUEUE
# SOCA_JOB_OWNER
# SOCA_JOB_NAME
# SOCA_JOB_PROJECT
# SOCA_VERSION
# SOCA_JOB_EFA
# SOCA_JOB_ID
# SOCA_SCRATCH_SIZE
# SOCA_INSTALL_BUCKET
# SOCA_INSTALL_BUCKET_FOLDER
# SOCA_FSX_LUSTRE_BUCKET
# SOCA_FSX_LUSTRE_DNS
# SOCA_INSTANCE_HYPERTHREADING
# SOCA_HOST_SYSTEM_LOG
# AWS_STACK_ID
# AWS_DEFAULT_REGION
# .. to add more, edit /etc/environment manually of through cluster_manager/cloudformation_builder.py

gather_facts: no
# Install required system package
- import_playbook: playbooks/system_packages.yml

# Install and configure the scheduler
- import_playbook: playbooks/scheduler.yml

# Install and configure LDAP
- import_playbook: playbooks/directory_service.yml

# Install and configure /scratch partition
- import_playbook: playbooks/scratch_partition.yml

# Configure Host
- import_playbook: playbooks/host_configuration.yml

# Reboot the system to finalize
- name: Reboot the machine, ComputeNodePostReboot.sh script will be executed once the host is back online
  reboot: