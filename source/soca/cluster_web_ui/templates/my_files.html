<!DOCTYPE html>
<html lang="en">

<head>
     {% include 'common/header.html' %}

    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dropzone.js') }}"></script>
    <link href="{{ url_for('static', filename='css/dropzone.css') }}" rel="stylesheet">

</head>

<body id="page-top">

  <div id="wrapper">
    {% include 'common/vertical_menu_bar.html' %}
    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">
          <br>
          <div class="container-fluid">
              {% include 'common/horizontal_menu_bar.html' %}
              <main role="main">
              {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <br>
                                {% if category == "success" %}
                                <div class="alert alert-success">
                                    <strong>{{ message | safe }} </strong>
                                </div>
                                {% else %}
                                 <div class="alert alert-danger">
                                    <strong>{{ message | safe }} </strong>
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                  <div class="row">
                  <div class="col-md-12">
                      <nav aria-label="breadcrumb">
                          <ol class="breadcrumb">
                              {% for path,folder_name in breadcrumb.items() %}
                              <li class="breadcrumb-item"><a href="/my_files?path={{ path }}">{{folder_name}}</a></li>
                              {% endfor %}

                          </ol>

                      </nav>
                  </div>
                  <div class="col-md-12">


<!-- Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Upload to SOCA</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <form action="/upload"  id="drop" class="dropzone" style="border: 2px dashed #0087F7;height: 200px">
              <div class="fallback">
                  <input name="file" type="file" multiple />
              </div>
          </form>
          <hr>
          Do not close the page while uploading<br>
          It's recommended to use the <a href="/sftp">SOCA SFTP solution</a> when trying to upload large files (>300mb).

      </div>

    </div>
  </div>
</div>
                  <table id="list_files_table" class="table row-border" style="width:100%">
        <thead>
            <tr>
                <th>Type</th>
                <th>Size</th>
                <th>Name</th>

            </tr>
        </thead>
        <tbody>
        <!--<tr>
                  <td style="visibility: hidden"></td>
            <td>
                <form class="form-inline" method="POST" action="/my_files/create_folder">
                    <div class="input-group mx-sm-3 mb-2">
                        <input type="text" size="50" class="form-control" id="folder_name" required placeholder="Name of your folder">
                        <div class="input-group-append">
                            <button class="btn btn-success" type="submit">Create Folder</button>
                        </div>
                    </div>

                     <div class="form-group mx-sm-3 mb-2">
                    <button type="button" class="btn btn-warning form-control" data-toggle="modal" data-target="#uploadModal">Upload file(s) in this directory</button>
                     </div>
                </form>


            </td>

              </tr>-->
          {% for folder_name, folder_data in folders.items() %}
              <tr>
                  <td> <i class="far fa-folder-open fa-lg"></i></td>
                  <td></td>
                  <td><a href="/my_files?path={{ folder_data.path }}">{{ folder_name }}</a> <a href="/my_files/delete?uid={{ folder_data.uid }}"><i class="fas fa-trash-alt float-right fa-lg" style="color: grey"></i></a> </td>

              </tr>
          {% endfor %}
         {%  for file_name,file_data in files.items() %}
             <tr>
             <td>
                          {% if file_name.endswith('.png') or file_name.endswith('.jpg') or file_name.endswith('.jpeg') %}
                              <i class="far fa-file-image fa-lg"></i>
                          {% elif file_name.endswith('.zip') or file_name.endswith('.tgz') or file_name.endswith('.tar.gz') or file_name.endswith('.rar') or file_name.endswith('.7z') %}
                              <i class="far fa-file-archive fa-lg"></i>
                                {% elif file_name.endswith('.pdf') %}
                                   <i class="far fa-file-pdf fa-lg"></i>
                              {% elif file_name.endswith('.ppt') or file_name.endswith('.pptx') %}
                                   <i class="far fa-file-powerpoint fa-lg"></i>
                              {% elif file_name.endswith('.csv') %}
                                   <i class="far fa-file-csv fa-lg"></i>
                               {% elif file_name.endswith('.avi') or file_name.endswith('.mkv') or file_name.endswith('.mpg')  %}
                              <i class="far fa-file-video fa-lg"></i>
                               {% elif file_name.endswith('.txt') or file_name.endswith('.log') or file_name.endswith('.cfg') or file_name.endswith('.conf')  %}
                              <i class="far fa-file-alt fa-lg"></i>
                          {% else %}
                              <i class="far fa-file-code fa-lg"></i>
                          {% endif %}
             </td>
             <td>
                 {{ file_data.st_size }}
             </td>
                 <td>

                     <div class="dropdown show">
                         <a href="/my_files/download?uid={{ file_data.uid }}">
                             {{ file_name }}
                         </a>
                         <div class="float-right">
                             <a href="/my_files/download?uid={{ file_data.uid }}"><i data-toggle="tooltip" data-placement="top" title="Download this file" class="fas fa-file-download fa-lg"  style="color: grey"></i></a>
                             <a href="/submit_job?input_file={{ file_data.uid }}"><i data-toggle="tooltip" data-placement="top" title="Use as simulation input" class="fas fa-microchip fa-lg"  style="color: grey"></i></a>
                             <i data-toggle="tooltip" data-placement="top" title="Last Modified: {{ file_data.st_mtime }}" class="far fa-clock fa-lg" style="color: grey"></i>
                             <a href="/my_files/delete?uid={{ file_data.uid }}"><i data-toggle="tooltip" data-placement="top" title="Delete file" class="fas fa-trash-alt fa-lg" style="color: grey"></i></a>
                         </div>
                     </div>



                 </td>

              </tr>
                      {% endfor %}


        </tbody>

    </table>
                  <script>
                      Dropzone.autoDiscover = false;
                      $("#drop").dropzone({
                          url: "/my_files/upload",
                          addRemoveLinks : true,
                          dictDefaultMessage: '<i class="fas fa-cloud-upload-alt fa-3x"></i> <h4>Drag and Drop files to upload or click</h4> File(s) will be uploader under {{ path }}',
                          maxFilesize: 10,
                          params: {
                                 path: "{{ path }}"
                          },
                          dictResponseError: 'Error uploading file!',
                          headers: {
                              'X-CSRFToken': "{{ csrf_token() |safe }}"
                          },
                          init: function () {
                              this.on('complete', function () {
                                  location.reload();
                              });
                          }
                      });


                      $(document).ready(function() {

                          // enable tooltip
                          $(function () {
                              $('[data-toggle="tooltip"]').tooltip()
                          })

                          // build datatable
                          $('#list_files_table').DataTable({
                              "paging": false,
                              dom: '<"toolbar">frtip',
                              language: {
                                  searchPlaceholder: "Search for a file or a folder",
                                  search: ""
                              },

                              fixedColumns: {
                                  heightMatch: 'none'
                              },
                          });
                          $('.dataTables_filter input[type="search"]').css({'align': 'center','font-weight': '400', 'font-size': '1rem', 'width':'500px','height': '38px', 'display':'inline-block'});
                          $("div.toolbar").html('<div class="float-right"><form class="form-inline" method="POST" action="/my_files/create_folder"><div class="input-group mx-sm-3 mb-2"><input type="text" size="25" class="form-control" name="folder_name" required placeholder="Name of your new folder"><div class="input-group-append"><input type="hidden" name="path" value="{{ path }}"> <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"><button class="btn btn-success" type="submit">Create Folder</button></div></div><div class="form-group mx-sm-3 mb-2"><button type="button" class="btn btn-warning form-control" data-toggle="modal" data-target="#uploadModal">Upload file(s)</button></div></form></div>');
                      });
                  </script>





                  </div>








                  </div>


              </main>




              </div>
          </div>
      </div>

  </div>

  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>


    {% include 'common/footer.html' %}

</body>

</html>
